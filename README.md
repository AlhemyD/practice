# Приложение по парсингу RINEX файлов #
## Выполнили Галиулина Оксана, Сисимирова Дарья, Пиякин Павел ##

Ссылка на используемый конвертатор в Rinex

`https://terras.gsi.go.jp/ja/crx2rnx.html` - Дата обращения: 19.06.2024

## Описание проекта ##
Данный проект представляет собой систему, разработанную для имитации потоков данных, получаемых с ГНСС (глобальной навигационной спутниковой системы) приемников в реальном времени. Наш проект имитирует процесс получения данных со спутника и направлению их к пользователю в режиме реального времени, то есть при наступлении определенного временного периода выводятся определенные данные, полученные со спутников.ые 

## Общие этапы работы ##

1. Данные скачиваются, архив с ними распаковывается, после чего файлы конвертируются в другой формат.
2. Запускается демон, который будет держать файла для парсига данных запущенным
3. После запускаются демоны для публикации данных из каждого файла.
4. Пользователь может запустиь subscriber и посмотреть какие данные приходят для данного момента времени.

## Архитектура проекта ##
![Архитектура](project_scheme_drawio.svg)

## Установка ##
1. Скачайте репозиторий с помощью команды, выполнив ее в терминале, находясь в домашней директории:
``git clone https://github.com/AlhemyD/practice.git``
2. Затем перейти в папку проекта командой ``cd practice``
3. Установить командой ``python3 setup.py install``
   
## Использование ##
### 1. Отредактируйте crontab (?): ###

Этот этап необходим для автоматического запуска всех нужных скриптов по определенному времени.

Cron – это планировщик задач. Если подробнее, то это утилита, позволяющая выполнять скрипты на сервере в назначенное время с заранее определенной периодичностью. Crontab – это таблица с расписанием запуска скриптов и программ, оформленная в специальном формате, который умеет считывать компьютер. Для каждого пользователя системы создается отдельный crontab-файл со своим расписанием. Эта встроенная в Linux утилита доступна на низком уровне в каждом дистрибутиве.


1.1 Откройте файл командой ``crontab -e``

1.2 Вставьте в конец файла строку ``0 0 * * * python3 /home/(имя вашего юзера)/practice/src/data_processing/main.py > /home/(имя вашего юзера)/output.log 2>&1``

   
### 2. Активируйте subscriber.py ###

2.1 Перейдите в папку командой ``cd practice/src/pub_sub/``

2.2 Запустите скрипт для получения данных от брокера командой ``python3 sub.py``

## Описание работы отдельных частей проекта: ##

## Работа с файлами ##

[**download.py**](https://github.com/AlhemyD/practice/blob/main/src/data_processing/download.py) отвечает за скачивание файлов. Скачивание файлов происходит в 22:00 по времени сервера, после наступления которого посылается запрос для получения данных по дате по ссылке "https://api.simurg.space/datafiles/map_files?date={date}", на место "{date}" встает дата, данные для которой получает приложение. Данные скачиваются в архив zip формата, название которого является текущей датой. После скачивания начинается процесс разархивации.

[**unzip_data.sh**](https://github.com/AlhemyD/practice/blob/main/src/data_processing/unzip_data.sh) отвечает за распаковку файлов. На вход подается дата, получаемая через main.py, после чего скрипт находит архив с названием дата.zip и начинает распаковку с помощью команды unzip, после данного процесса скрипт приступает к распаковке самих файлов, он проходится по архиву и с помощью команды gunzip разархивирует файлы. После этого удаляется архив и работа переходит к форматированию.

[**formatting.py**](https://github.com/AlhemyD/practice/blob/main/src/data_processing/formatting.py) отвечает за конвертацию файлов в другой формат. На вход данный скрипт получает путь к файлу, после чего проверяет существует ли такой файл, применяет комаанду ``../../lib/RNXCMP_4.1.0_Linux_x86_32bit/bin/CRX2RNX`` и удаляет файл с расширением rnx или d, на выходе мы получаем сконвертированные в формат crx файлы. 

[**parser.py**](https://github.com/AlhemyD/practice/blob/main/src/data_processing/parser.py) отвечает за парсинг файлов, используется в **scriprnx.py**. На вход данный скрипт получает название файла, после этого он наинает с помощью библиотеки gnss-tec получать данные из файла формата rnx/o.

[**scriprnx.py**](https://github.com/AlhemyD/practice/blob/main/src/data_processing/scriprnx.py) также отвечает за парсинг файлов. Данный скрипт использует fastapi и функцию парсинга из **parser.py** в своей работе. Демон для данного файла создается после форматирования, если его не было в нужной директории. После запуска данного скрипта publisher обращается к нему для парсинга файлов.

После запуска демона для **scriprnx.py** генерируются демоны для публикации файлов.

## Запуск демонов и описание их работы ##



## Publisher ##

## Subscriber ##

## Лицензия
Этот проект распространяется под лицензией MIT. Подробности можно найти в файле LICENSE.
